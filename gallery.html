<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - MINDORA.ART</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <link rel="icon" href="/favicon.png" type="image/png">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand gradient-text" href="index.html">
                <i class="fas fa-brain me-2"></i>MINDORA.ART
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="gallery.html">
                            <i class="fas fa-images me-1"></i>Gallery
                        </a>
                    </li>
                    <li class="nav-item" id="createNavItem" style="display: none;">
                        <a class="nav-link" href="create.html">
                            <i class="fas fa-plus-circle me-1"></i>Create
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#about">
                            <i class="fas fa-info-circle me-1"></i>About
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item" id="loginNavItem">
                        <button class="btn btn-outline-light" id="loginBtn">
                            <i class="fas fa-sign-in-alt me-1"></i>Login
                        </button>
                    </li>
                    <li class="nav-item" id="userNavItem" style="display: none;">
                        <div class="dropdown">
                            <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i><span id="userDisplayName">User</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user-circle me-2"></i>Profile</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><button class="dropdown-item" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</button></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Gallery Header -->
    <section class="gallery-header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1 class="gradient-text mb-4">Creative Gallery</h1>
                    <p class="lead">Discover amazing works from our global community</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters -->
    <section class="filters-section py-4">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <button class="btn btn-outline-primary active" data-filter="all">
                            <i class="fas fa-globe me-1"></i>All
                        </button>
                        <button class="btn btn-outline-primary" data-filter="Art">
                            <i class="fas fa-palette me-1"></i>Art
                        </button>
                        <button class="btn btn-outline-primary" data-filter="Science">
                            <i class="fas fa-flask me-1"></i>Science
                        </button>
                        <button class="btn btn-outline-primary" data-filter="Literature">
                            <i class="fas fa-book me-1"></i>Literature
                        </button>
                        <button class="btn btn-outline-primary" data-filter="Audio">
                            <i class="fas fa-music me-1"></i>Audio
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Grid -->
    <section class="gallery-grid py-5">
        <div class="container">
            <div id="loadingSpinner" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading creative works...</p>
            </div>
            
            <div id="galleryGrid" class="row g-4" style="display: none;">
                <!-- Works will be dynamically loaded here -->
            </div>

            <div id="emptyState" class="text-center py-5" style="display: none;">
                <i class="fas fa-images fa-4x text-muted mb-4"></i>
                <h3 class="text-muted">No works found</h3>
                <p class="text-muted">Be the first to share your creativity!</p>
                <a href="create.html" class="btn btn-primary" id="emptyCreateBtn" style="display: none;">
                    <i class="fas fa-plus me-2"></i>Create Your First Work
                </a>
            </div>
        </div>
    </section>

    <!-- Work Detail Modal -->
    <div class="modal fade" id="workDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="workDetailTitle">Work Title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div id="workDetailContent">
                                <!-- Content will be loaded here -->
                            </div>
                            <div class="mt-3">
                                <h6>Description</h6>
                                <p id="workDetailDescription">Work description</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="work-meta">
                                <h6>Details</h6>
                                <p><strong>Category:</strong> <span id="workDetailCategory">Category</span></p>
                                <p><strong>Author:</strong> <span id="workDetailAuthor">Author</span></p>
                                <p><strong>Published:</strong> <span id="workDetailDate">Date</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
        <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title gradient-text">Welcome to MINDORA.ART</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="loginForm">
                        <h6 class="mb-3">Sign In</h6>
                        <form id="signInForm">
                            <div class="mb-3">
                                <label for="signInEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="signInEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="signInPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="signInPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mb-3">Sign In</button>
                        </form>
                        <p class="text-center">
                            Don't have an account? 
                            <a href="#" id="showSignUp" class="text-primary">Sign up here</a>
                        </p>
                    </div>
                    <div id="signUpForm" style="display: none;">
                        <h6 class="mb-3">Create Account</h6>
<form id="createAccountForm">
    <div class="mb-3">
        <label for="signUpName" class="form-label">Display Name</label>
        <input type="text" class="form-control" id="signUpName" required>
    </div>
    <div class="mb-3">
        <label for="signUpEmail" class="form-label">Email</label>
        <input type="email" class="form-control" id="signUpEmail" required>
    </div>
    <div class="mb-3">
        <label for="signUpPassword" class="form-label">Password</label>
        <input type="password" class="form-control" id="signUpPassword" required minlength="6">
    </div>
    <div class="mb-3">
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="privacyPolicy" required>
            <label class="form-check-label" for="privacyPolicy">
                I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
            </label>
        </div>
    </div>
    <button type="submit" class="btn btn-primary w-100 mb-3">Create Account</button>
</form>
                        <p class="text-center">
                            Already have an account? 
                            <a href="#" id="showSignIn" class="text-primary">Sign in here</a>
                        </p>
                    </div>
                    <div id="authError" class="alert alert-danger" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Privacy Policy Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Privacy Policy</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>
          Please review our <a href="privacy_policy.html" target="_blank">full Privacy Policy</a> for details on how we collect, use, and protect your data.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Other scripts -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script>
        // Gallery-specific functionality
        let allWorks = [];
        let currentFilter = 'all';

        // Load works on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGalleryWorks();
            setupFilters();
        });

        // Setup filter buttons
        function setupFilters() {
            document.querySelectorAll('[data-filter]').forEach(button => {
                button.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('[data-filter]').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Apply filter
                    currentFilter = this.dataset.filter;
                    displayFilteredWorks();
                });
            });
        }

        // Load all works from Firestore
        async function loadGalleryWorks() {
            try {
                const querySnapshot = await firebase.firestore().collection('works')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                allWorks = [];
                querySnapshot.forEach((doc) => {
                    allWorks.push({ id: doc.id, ...doc.data() });
                });

                document.getElementById('loadingSpinner').style.display = 'none';
                
                if (allWorks.length === 0) {
                    document.getElementById('emptyState').style.display = 'block';
                    // Show create button only if user is logged in
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            document.getElementById('emptyCreateBtn').style.display = 'inline-block';
                        }
                    });
                } else {
                    document.getElementById('galleryGrid').style.display = 'block';
                    displayFilteredWorks();
                }
            } catch (error) {
                console.error('Error loading works:', error);
                document.getElementById('loadingSpinner').innerHTML = 
                    '<p class="text-danger">Error loading works. Please try again later.</p>';
            }
        }

        // Display filtered works
        function displayFilteredWorks() {
            const filteredWorks = currentFilter === 'all' 
                ? allWorks 
                : allWorks.filter(work => work.category === currentFilter);

            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = '';

            filteredWorks.forEach(work => {
                const workCard = createWorkCard(work);
                grid.appendChild(workCard);
            });

            if (filteredWorks.length === 0 && currentFilter !== 'all') {
                grid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No ${currentFilter} works found</h4>
                        <p class="text-muted">Try a different category or check back later!</p>
                    </div>
                `;
            }
        }

        // Create work card element
        function createWorkCard(work) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4';

            const categoryIcon = getCategoryIcon(work.category);
            const contentPreview = getContentPreview(work);
            const formattedDate = new Date(work.createdAt.seconds * 1000).toLocaleDateString();

            col.innerHTML = `
                <div class="work-card h-100" data-work-id="${work.id}">
                    <div class="work-card-header">
                        <div class="category-badge">
                            <i class="${categoryIcon} me-1"></i>${work.category}
                        </div>
                    </div>
                    <div class="work-card-content">
                        ${contentPreview}
                    </div>
                    <div class="work-card-body">
                        <h5 class="work-title">${work.title}</h5>
                        <p class="work-description">${work.description.length > 100 ? 
                            work.description.substring(0, 100) + '...' : work.description}</p>
                        <div class="work-meta">
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>${work.authorName}
                                <span class="ms-3">
                                    <i class="fas fa-calendar me-1"></i>${formattedDate}
                                </span>
                            </small>
                        </div>
                    </div>
                </div>
            `;

            // Add click event to open modal
            col.querySelector('.work-card').addEventListener('click', () => {
                showWorkDetail(work);
            });

            return col;
        }

        // Get category icon
        function getCategoryIcon(category) {
            const icons = {
                'Art': 'fas fa-palette',
                'Science': 'fas fa-flask',
                'Literature': 'fas fa-book',
                'Audio': 'fas fa-music'
            };
            return icons[category] || 'fas fa-file';
        }

        // Get content preview based on type
        function getContentPreview(work) {
            switch (work.category) {
                case 'Art':
                    if (work.fileUrl) {
                        return `<div class="work-image">
                            <img src="${work.fileUrl}" alt="${work.title}" class="img-fluid">
                        </div>`;
                    }
                    break;
                case 'Literature':
                case 'Science':
                    return `<div class="work-text-preview">
                        <p>${work.content ? work.content.substring(0, 200) + '...' : 'Click to read more'}</p>
                    </div>`;
                case 'Audio':
                    return `<div class="work-audio-preview">
                        <i class="fas fa-play-circle fa-3x text-primary"></i>
                        <p class="mt-2">Click to listen</p>
                    </div>`;
            }
            return `<div class="work-placeholder">
                <i class="fas fa-file fa-2x text-muted"></i>
            </div>`;
        }

        // Show work detail in modal
        function showWorkDetail(work) {
            document.getElementById('workDetailTitle').textContent = work.title;
            document.getElementById('workDetailDescription').textContent = work.description;
            document.getElementById('workDetailCategory').textContent = work.category;
            document.getElementById('workDetailAuthor').textContent = work.authorName;
            document.getElementById('workDetailDate').textContent = 
                new Date(work.createdAt.seconds * 1000).toLocaleDateString();

            const contentDiv = document.getElementById('workDetailContent');
            
            switch (work.category) {
                case 'Art':
                    if (work.fileUrl) {
                        contentDiv.innerHTML = `<img src="${work.fileUrl}" alt="${work.title}" class="img-fluid rounded">`;
                    } else {
                        contentDiv.innerHTML = '<p class="text-muted">No image available</p>';
                    }
                    break;
                case 'Literature':
                case 'Science':
                    contentDiv.innerHTML = `<div class="work-text-content">
                        ${work.content ? work.content.replace(/\n/g, '<br>') : 'No content available'}
                    </div>`;
                    break;
                case 'Audio':
                    if (work.fileUrl) {
                        contentDiv.innerHTML = `
                            <audio controls class="w-100">
                                <source src="${work.fileUrl}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        `;
                    } else {
                        contentDiv.innerHTML = '<p class="text-muted">No audio file available</p>';
                    }
                    break;
                default:
                    contentDiv.innerHTML = '<p class="text-muted">Content not available</p>';
            }

            new bootstrap.Modal(document.getElementById('workDetailModal')).show();
        }
    </script>
</body>
</html>
